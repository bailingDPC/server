(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0cc28162"],{"159b":function(t,e,n){var i=n("da84"),a=n("fdbc"),c=n("17c2"),s=n("9112");for(var r in a){var o=i[r],l=o&&o.prototype;if(l&&l.forEach!==c)try{s(l,"forEach",c)}catch(u){l.forEach=c}}},"17c2":function(t,e,n){"use strict";var i=n("b727").forEach,a=n("a640"),c=n("ae40"),s=a("forEach"),r=c("forEach");t.exports=s&&r?[].forEach:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}},"34c5":function(t,e,n){},4160:function(t,e,n){"use strict";var i=n("23e7"),a=n("17c2");i({target:"Array",proto:!0,forced:[].forEach!=a},{forEach:a})},"95f4":function(t,e,n){"use strict";var i=n("34c5"),a=n.n(i);a.a},b727:function(t,e,n){var i=n("0366"),a=n("44ad"),c=n("7b0b"),s=n("50c4"),r=n("65f0"),o=[].push,l=function(t){var e=1==t,n=2==t,l=3==t,u=4==t,d=6==t,f=5==t||d;return function(m,h,p,v){for(var y,g,_=c(m),b=a(_),x=i(h,p,3),C=s(b.length),w=0,L=v||r,k=e?L(m,C):n?L(m,0):void 0;C>w;w++)if((f||w in b)&&(y=b[w],g=x(y,w,_),t))if(e)k[w]=g;else if(g)switch(t){case 3:return!0;case 5:return y;case 6:return w;case 2:o.call(k,y)}else if(u)return!1;return d?-1:l||u?u:k}};t.exports={forEach:l(0),map:l(1),filter:l(2),some:l(3),every:l(4),find:l(5),findIndex:l(6)}},ef0d:function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"Message"},[n("Nav"),n("div",{staticClass:"main"},[n("div",{staticClass:"content"},[n("article",[n("section",[n("h2",[t._v("留言板")]),n("p",[t._v("沟通交流，拉近你我！")]),n("RichText",{on:{sub:t.handleSubmit}})],1),n("section",[n("ul",t._l(t.commentList,(function(e,i){return n("li",{key:e._id},[n("div",{staticClass:"comment-parent"},[n("div",{staticClass:"p-img",style:{backgroundImage:"url("+e.user.photo+")"}}),n("div",{staticClass:"p-info"},[n("div",{staticClass:"p-name"},[t._v(t._s(e.user.user))]),n("div",{staticClass:"p-content",domProps:{innerHTML:t._s(e.content)}}),n("div",{staticClass:"p-time"},[n("span",[t._v(t._s(t._f("getTime")(e.date)))]),n("a",{on:{click:function(e){return t.replyClick(i)}}},[t._v(" "+t._s(e.reply.lastIndexArr[0]===i&&void 0===e.reply.lastIndexArr[1]?"收起":"回复")+" ")])])])]),t._l(e.children,(function(a,c){return n("div",{key:a.date+Math.random(),staticClass:"comment-child"},[n("div",{staticClass:"c-img",style:{backgroundImage:"url("+a.user.photo+")"}}),n("div",{staticClass:"c-info"},[n("div",{staticClass:"c-name"},[n("span",{staticClass:"name"},[t._v(t._s(a.user.user))]),t._v("回复"),n("span",{staticClass:"name"},[t._v(t._s(a.reUser))]),n("span",[t._v(t._s(a.content))])]),n("div",{staticClass:"c-time"},[n("span",[t._v(t._s(t._f("getTime")(a.date)))]),n("a",{on:{click:function(e){return t.replyClick(i,c)}}},[t._v(" "+t._s(e.reply.lastIndexArr[0]===i&&e.reply.lastIndexArr[1]===c?"收起":"回复")+" ")])])])])})),n("div",{class:["comment-reply",{show:e.reply.ifShow}]},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:e.reply.content,expression:"item.reply.content"}],attrs:{placeholder:"回复【"+e.reply.reUser+"】："},domProps:{value:e.reply.content},on:{input:function(n){n.target.composing||t.$set(e.reply,"content",n.target.value)}}}),n("button",{staticClass:"layui-btn layui-btn-xs",attrs:{type:"button"},on:{click:function(e){return t.childCommit(i)}}},[t._v(" 提交 ")])])],2)})),0)])])])])],1)},a=[],c=(n("99af"),n("4160"),n("159b"),n("216c")),s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("textarea",{staticStyle:{display:"none"},attrs:{id:"richText"}}),n("button",{staticClass:"layui-btn",attrs:{type:"button"},on:{click:t.handleClick}},[t._v("提交留言")])])},r=[],o={name:"RichText",data:function(){return{layedit:null,index:0}},methods:{handleClick:function(){this.$emit("sub",this.layedit.getContent(this.index))}},mounted:function(){var t=this;layui.use("layedit",(function(){t.layedit=layui.layedit,t.index=t.layedit.build("richText",{tool:["face"]})}))}},l=o,u=n("2877"),d=Object(u["a"])(l,s,r,!1,null,"597b5ac1",null),f=d.exports,m=n("365c");function h(t){return(t<10?"0":"")+t}var p={name:"Message",data:function(){return{commentList:[],skip:0,limit:0,ifLoding:!1}},filters:{getTime:function(t){var e=new Date(t),n=h(e.getFullYear()),i=h(e.getMonth()+1),a=h(e.getDate()),c=h(e.getHours()),s=h(e.getMinutes()),r=h(e.getSeconds());return"".concat(n,"年").concat(i,"月").concat(a,"日 ").concat(c,":").concat(s,":").concat(r)}},methods:{handleSubmit:function(t){Object(m["D"])().then((function(e){e.data.userInfo?Object(m["b"])({user:e.data.userInfo._id,content:t}).then((function(t){0===t.data.code?(layer.msg("留言成功",{icon:1}),setTimeout((function(){window.location.reload()}),1e3)):layer.msg(t.data.msg,{icon:2})})).catch((function(){layer.msg("服务器错误~请稍后再试",{icon:2})})):layer.msg("请先登录",{icon:2})})).catch((function(){layer.msg("服务器错误~请稍后再试",{icon:2})}))},replyClick:function(t,e){if(void 0!==t){var n=this.commentList[t];this.commentList[t].reply.reUser=void 0!==e?this.commentList[t].children[e].user.user:this.commentList[t].user.user,t===n.reply.lastIndexArr[0]&&e===n.reply.lastIndexArr[1]?(n.reply.ifShow=!1,n.reply.lastIndexArr=[]):(n.reply.ifShow=!0,n.reply.lastIndexArr=[t,e])}},childCommit:function(t){var e=this;Object(m["D"])().then((function(n){n.data.userInfo?Object(m["a"])({parentId:e.commentList[t]._id,user:n.data.userInfo._id,content:e.commentList[t].reply.content,reUser:e.commentList[t].reply.reUser}).then((function(t){t.data.code?layer.msg(t.data.msg,{icon:2}):(layer.msg("评论成功",{icon:1}),setTimeout((function(){window.location.reload()}),1e3))})):layer.msg("请先登录",{icon:2})})).catch((function(){layer.msg("服务器错误~请稍后再试",{icon:2})}))},handleScroll:function(){var t=this;if(!this.ifLoding){var e=document.documentElement.offsetHeight,n=document.documentElement.scrollTop,i=document.documentElement.clientHeight;n+i>=e-200&&(this.ifLoding=!0,this.getMessageList((function(){t.ifLoding=!1})))}},getMessageList:function(t){var e=this;this.limit+=5,Object(m["t"])(this.skip,this.limit).then((function(n){if(0===n.data.code){var i=n.data.data;i.forEach((function(t){t.reply={user:"",content:"",reUser:"",date:"",ifShow:!1,lastIndexArr:[]}})),e.commentList=i}t&&t()})).catch((function(){t&&t()}))}},components:{Nav:c["a"],RichText:f},created:function(){this.getMessageList()},mounted:function(){window.addEventListener("scroll",this.handleScroll)},destroyed:function(){window.removeEventListener("scroll",this.handleScroll)}},v=p,y=(n("95f4"),Object(u["a"])(v,i,a,!1,null,"0ce225d6",null));e["default"]=y.exports}}]);
//# sourceMappingURL=chunk-0cc28162.72407ffe.js.map